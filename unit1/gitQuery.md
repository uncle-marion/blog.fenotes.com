> 平安蜀黍的前端教程 > 备选知识点 > git 版本管理之常见问题解决

## 萌新怎样开展第一个任务

你刚进入公司，电脑环境可能刚刚装好一些常用软件，代码什么的都还没有，也许产品或你的 leader 会丢给你一个任务，要你去熟悉一下项目甚至解决某个问题：

**step 1**:

```shell
# 进入你的工作目录！
# 很重要，你将来可能会经手上百个项目，一定要有一个工作目录来管理而不是将代码四处乱放
cd workspace
```

**step 2:**

```shell
# 这个项目地址可能是需要你自己去找的，
# 组长会告诉你公司的 gitlab 库的地址，然后你要去找到对应的项目
git clone <项目地址>
```

**step 3:**

```shell
# clone 完成后，会在当前工作目录下生成一个新的目录，这个目录与你的项目同名，你需要进入这个项目才能继续操作
cd <项目目录>
```

**step 4:**

将当前项目加入到你的 vscode 中，如果你的项目都在同一个工作目录，你可以将这个工作目录加入到 vscode，这样每次添加项目都会直接在工作目录中展示出来

**step 5:**

打开 package.json，仔细查阅 dependencies 和 devDependencies 这两项，看看是否有公司内部的依赖，如果有，找你的组长，要一下公司 npm 仓库镜像地址

**step 6:**

切换你的 npm 镜像地址到公司地址：

```shell
npm config set registry <你的组长给你的地址>
# 也可以执行 yarn config set registry <你的组长给你的地址>
```

**step 7:**

```shell
yarn # 或 npm i 安装项目依赖
```

**step 8:**

因为项目大小与网速的问题，安装项目依赖可能需要等待一些时间，那么你可以利用这个时间看看项目中的一些文件

> - 8.1 package.json 中的 scripts 部分，了解项目的运行方式有哪些
>
> - 8.2 检查 router 与 store，了解项目的基本文件构成与相关的状态管理工具
>
> - 8.3 检查项目根目录下的其它文件，很多项目独有的配置都在这里，记一下有好处
>
> - 8.4 浏览 pages 或 components 中的文件，了解其他同事的编程规范和代码性格

**step 9:**

```shell
# 确认基本没有问题后，基于主支新建或切换到你组长给你开的分支开始编辑或修改代码
git checkout -b <分支名称> <主支名称> 或 git checkout <分支名称>
```

**step 10:**

```shell
# 代码修改完成后，执行这个命令检查修改了哪些文件
git status
```

**step 11:**

```shell
# 比较开发区与暂存区的代码差异，确认修改无误，如果有问题先解决问题
git diff
```

**step 12:**

```shell
# 确认修改无误后，将开发区所有修改或指定修改添加到暂存库
git add <文件路径/文件名>
# 如果你确认只修改过本次需求所需要修改的文件，也可以执行git add .
# add . 表示提交当前工作区所有修改过的文件
```

**step 13:**

```shell
# 将远端的代码拉回到开发区，这时候可能会存在代码冲突，解决可能存在的冲突后再次提交代码到暂存库
git pull
```

**step 14:**

```shell
# 将暂存库中的内容提交到本地库，注意，这里的描述内容可能会有不同的规范，可以询问你的同事或组长
git commit -m '你的修改内容描述'
```

**step 15:**

```shell
# 提交你的代码到远程库，整个代码修改流程到此结束，你可以跟你的 leader 说一下，他会在代码检查后进行代码合并
git push
```

## 各种问题

### 无法提交代码

可能出现提交失败的原因有很多，比如文件权限、冲突等，你需要阅读提交后返回的错误提示，解决可能存在的权限问题，然后执行以下操作

```shell
git add . # 添加所有修改
git commit -m "本次提交的修改内容" # 提交修改
git pull origin <branch> # 处理冲突
git push origin <branch> # 提交到服务器
```

### 误删了文件或文件夹

```shell
git ls-files --deleted # 确认被删除的文件或文件夹
git checkout <commit> <file> # 恢复指定版本的文件或文件夹
git reset HEAD <file> # 取消删除操作，恢复文件或文件夹
```

### 回滚到上一次提交

```shell
git log # 查看提交记录，获取上一次提交的ID
git reset <commit> # 回滚到上一次提交
git push -f origin <branch> # 强制提交回滚后的代码
```

### 撤销修改

```shell
git checkout <file> 丢弃工作区修改
git reset HEAD <file> 丢弃暂存区修改
```

### 忽略文件/文件夹

有时候我们需要在本地增加一些文件，但又不想这些文件提交到仓库。我们可以先检查当前项目来判断是否需要生成.gitignore 文件，然后通过编辑.gitignore 文件来指定需要忽略的文件或文件夹。

### HotFix

你当前正在开发中，可能因为各种原因代码无法提交暂存区，但线上出 BUG 了，需要临时切换分支，怎么办？

首先逐项执行下面的命令：

```shell
git stash # 保存当前代码到暂存区的临时区
git checkout master # 切换当前分支到主分支
git branch <hotfix name> # 创建解决BUG用的分支名
git checkout <hotfix name> # 切换到解决问题用的分支
```

进入创建的 HotFix 分支后修改代码解决问题，当问题解决完成并提交成功后执行下面的命令：

```shell
git checkout <你刚刚正在编辑的分支名称> # 切换回当前分支
git stash apply # 将刚刚保存到暂存区的代码取回并应用到开发区
```

### 提交时遇上太多冲突无法正常处理

- 第一种方案：放弃本地更改，覆盖更新

```shell
git fetch --all
git reset --hard origin/<分支名称>
```

git fetch 只是下载远程库中的内容到本地库，如果你的本地库是干净的，基本不会有任何问题，如果你有之前提交到本地库的代码，可能还是需要做一些解决冲突的工作。解决完所有冲突后我们需要使用 git reset 命令将 head 指向刚刚下载的最新的版本。

- 第二种方案：保留本地修改且更新到最新内容

```shell
git stash
git pull
git stash pop stash@{0}
```

首先将本地更改缓存起来，然后获取远程库中最新的版本，最后合并本地缓存中的内容到刚刚下载的最新版本中，需要注意的是，必须要逐个解决提示 auto-merging 的文件中的冲突

#### 个人建议：

解决几十上百行代码冲突的情况是很可怕的，极有可能你解决的某个冲突就导致了其他同事的代码无法正常运行，所以我们要在工作中养成一个良好的操作习惯，尽量避免出现大量冲突的情况：

1. 尽可能频繁地使用 git pull 同步代码，每次修改都基于最新的源码，大大减少发生冲突的概率。

2. 减少每次提交代码的行数，每次做完一个小修改就提交并上传代码。这样即使发生冲突了，你也能很好地解决。

比如，我们每天早上和中午到工位后的第一件事就是同步线上代码，每天中午或晚上离开工位前最后一件事就是提交代码。养成这种习惯会减少很多麻烦。

### 项目上线出现问题，需要回滚，怎么处理

#### 怎样回滚代码

```shell
git reset --hard <指定版本号> # 回滚到指定版本
git reset --hard HEAD^ # 回滚到上次提交
```

#### 怎样获取版本号呢

```shell
git log # 打印日志，并复制你想要回滚到的版本号的前 8 位
```

#### 回滚后的代码版本号低于远程库中的版本号，怎么提交？

```shell
git push origin HEAD --force # 因为开发区版本低于库中的版本，所以需要强制提交
```
