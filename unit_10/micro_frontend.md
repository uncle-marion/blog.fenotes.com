> Marion 的 react 实战课程 > 第十一部分 > 微前端的概念

## 什么是微前端

将一个复杂大型的应用程序拆解成颗粒度更小的可以独立开发、测试及部署的小模块，并通过一些策略方案来确定这些模块之间的依赖关系。

理解微前端之前，我们需要一个例子：例如，我们现在写的这个项目，根据它的整个流程，可以拆分为首页、产品、订单、会员四个分支，每个分支对应不同的业务场景。比如首页，仅需展示各种活动与产品列表，而用户如果点击了 tab 中的分类按钮，那么就相当于在当前的 layout 中引入了一个新的应用进来。

所以，真正的微前端就是将不同的功能按照不同的维度拆分成多个子应用。通过主应用来加载这些子应用。微前端的核心在于**拆**，拆完后再**合**！

## 微前端的特点

- **代码库更小，可维护性更高**  
  比起传统的一整个项目代码块，微前端架构下的代码块更小、更容易开发。还可以避免模块之间的隐式耦合。独立性更强，维护性更高

- **渐进式升级、更新以及对项目的重构功能**  
  微前端架构可以让新旧代码和谐共存，在重构时，可以一边将旧的应用逐步翻新，一边继续提供新功能，直到整个重构完成。这种增量升级的能力意味着能够对产品功能进行低风险的局部替换，包括升级依赖项、更替架构、UI 改版等。另一方面，也带来了技术选型上的灵活性，有助于新技术、新交互模式的实验性试错。

- **独立部署**  
  独立部署在微前端中非常重要，子模块之间只有部署，才能减轻依赖，降低耦合。独立部署能够缩小项目变更范围，降低生产风险。无论前端代码在何处托管，每个微前端都应该有连续交付通道，该通道可以构建、测试并将其一直部署到生产环境中

## 微前端现在遇到的一些问题

### 1. 集成的问题

在微前端架构中一般会有一个容器应用将各子应用集成起来。比如统一的 Header、Footer、Navigator 等。提供一些公共的方法。然后把各个子模块整合到一个页面上，并控制渲染区域和时机。

- **服务端集成：**  
  每个子服务负责独立渲染对应的微前端应用，由主服务向各个子服务发起请求。

- **构建时集成：**  
  常见的构建时集成是 NPM 包形式抽离和引用，可以将各个子应用发布成独立的 NPM 包，并作为主应用的依赖项，构建成一个可以直接部署的 Bundle。不过这种方式会在发布阶段造成应用之间的强耦合，任何一个子应用变更都要重新构建整个项目。

- **运行时集成：**  
  将集成时机从构建时推迟到运行时，就能避免发布阶段的耦合。常见的运行时集成方式有：

> - **iframe**  
>   支持样式隔离及全局变量隔离。性能差，通信复杂，灵活性差。

> - **JS：比如前端路由**  
>   由每个子应用暴露出渲染函数，主应用在启动时加载各个子应用的独立 Bundle，之后根据路由规则渲染相应的子应用。目前看来，是最灵活的方式

> - **Web Components**  
>   将每个子应用封装成自定义 HTML 元素（而不是前端路由方案中的渲染函数），以获得 Shadow DOM 带来的样式隔离等好处。

### 2.隔离的问题

子应用之间，子应用和主应用之间的样式、作用域隔离是必须要考虑的问题。常用的解决方案如下：

- 样式隔离：开发规范（如 BEM）、CSS 预处理（如 SASS）、模块定义（如 CSS Module）、用 JS 来写（CSS-in-JS）、以及 shadow DOM 特性

- 作用域隔离：各种模块定义（如 ES Module、AMD、Common Module、UMD）

### 3.通信的问题

- 通过自定义事件间接通信，这种方式是一种避免直接耦合的常用方式。

- React 的单向数据流模型也能让依赖关系更加明确，对应到微前端中，从容器应用向子应用传递数据与回调函数。

- 路由参数除了能用于分享、书签等场景外，也可以作为一种通信手段

### 4.资源复用的问题

- 基础资源 项目中需要使用到的图片、图标、标签、按钮等。

- UI 组件 含有一定逻辑的 UI 组件。如搜索框（自动完成）、表格（如排序、筛选、分页）等。

- 业务组件 含有业务逻辑的业务组件，不建议跨子应用复用业务组件，因为会造成高度耦合，增加变更成本

## 微前端实例(乾坤)

在讲解实例之前，我们需要明白一个道理：橘生淮南则为橘，生于淮北则为枳；意思是说，环境变化了，事物的性质也就变了。与之前我们说的关于类组件与函数组件的使用场景一样，我们需要在合适的环境下使用它，不要因为它最近比较火就在所有的项目中去引用。

**文档地址：**https://qiankun.umijs.org/zh
